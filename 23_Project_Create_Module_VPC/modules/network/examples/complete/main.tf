# =============================================================================\n# COMPLETE NETWORK MODULE EXAMPLE\n# =============================================================================\n# This example demonstrates a comprehensive usage of the network module,\n# showcasing various configuration options and best practices for creating\n# a multi-tier VPC architecture with high availability.\n\n# Configure Terraform and required providers\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 6.0\"\n    }\n  }\n}\n\n# Configure the AWS Provider\nprovider \"aws\" {\n  region = \"us-west-1\"\n}\n\n# Example 1: Basic VPC with public and private subnets\nmodule \"basic_network\" {\n  source = \"../../\"  # Path to the network module\n  \n  vpc_config = {\n    cidr_block = \"10.0.0.0/16\"\n    name       = \"Basic-Example-VPC\"\n  }\n  \n  subnet_config = {\n    public_subnet = {\n      cidr_block = \"10.0.1.0/24\"\n      name       = \"Basic Public Subnet\"\n      azs        = \"us-west-1a\"\n      public     = true\n    }\n    private_subnet = {\n      cidr_block = \"10.0.2.0/24\"\n      name       = \"Basic Private Subnet\"\n      azs        = \"us-west-1b\"\n      public     = false\n    }\n  }\n}\n\n# Example 2: Multi-tier architecture with high availability\nmodule \"multi_tier_network\" {\n  source = \"../../\"  # Path to the network module\n  \n  vpc_config = {\n    cidr_block = \"172.16.0.0/16\"\n    name       = \"Multi-Tier-Production-VPC\"\n  }\n  \n  subnet_config = {\n    # Web tier - public subnets for load balancers and NAT gateways\n    web_subnet_1a = {\n      cidr_block = \"172.16.1.0/24\"\n      name       = \"Web Tier Subnet AZ-1A\"\n      azs        = \"us-west-1a\"\n      public     = true\n    }\n    web_subnet_1c = {\n      cidr_block = \"172.16.2.0/24\"\n      name       = \"Web Tier Subnet AZ-1C\"\n      azs        = \"us-west-1c\"\n      public     = true\n    }\n    \n    # Application tier - private subnets for application servers\n    app_subnet_1a = {\n      cidr_block = \"172.16.11.0/24\"\n      name       = \"Application Tier Subnet AZ-1A\"\n      azs        = \"us-west-1a\"\n      public     = false\n    }\n    app_subnet_1c = {\n      cidr_block = \"172.16.12.0/24\"\n      name       = \"Application Tier Subnet AZ-1C\"\n      azs        = \"us-west-1c\"\n      public     = false\n    }\n    \n    # Database tier - private subnets for databases\n    db_subnet_1a = {\n      cidr_block = \"172.16.21.0/24\"\n      name       = \"Database Tier Subnet AZ-1A\"\n      azs        = \"us-west-1a\"\n      public     = false\n    }\n    db_subnet_1c = {\n      cidr_block = \"172.16.22.0/24\"\n      name       = \"Database Tier Subnet AZ-1C\"\n      azs        = \"us-west-1c\"\n      public     = false\n    }\n  }\n}\n\n# Example 3: Development environment with minimal resources\nmodule \"dev_network\" {\n  source = \"../../\"  # Path to the network module\n  \n  vpc_config = {\n    cidr_block = \"192.168.0.0/16\"\n    name       = \"Development-VPC\"\n  }\n  \n  subnet_config = {\n    dev_public = {\n      cidr_block = \"192.168.1.0/24\"\n      name       = \"Development Public Subnet\"\n      azs        = \"us-west-1a\"\n      public     = true\n    }\n    dev_private = {\n      cidr_block = \"192.168.2.0/24\"\n      name       = \"Development Private Subnet\"\n      azs        = \"us-west-1a\"\n      public     = false\n    }\n  }\n}\n\n# =============================================================================\n# OUTPUTS - Demonstrating module output consumption\n# =============================================================================\n\n# Basic network outputs\noutput \"basic_vpc_id\" {\n  description = \"VPC ID from the basic network example\"\n  value       = module.basic_network.vpc_id\n}\n\noutput \"basic_public_subnets\" {\n  description = \"Public subnets from the basic network example\"\n  value       = module.basic_network.public_subnets\n}\n\noutput \"basic_private_subnets\" {\n  description = \"Private subnets from the basic network example\"\n  value       = module.basic_network.private_subnets\n}\n\n# Multi-tier network outputs\noutput \"multi_tier_vpc_id\" {\n  description = \"VPC ID from the multi-tier network example\"\n  value       = module.multi_tier_network.vpc_id\n}\n\noutput \"multi_tier_web_subnets\" {\n  description = \"Web tier subnets from the multi-tier network example\"\n  value       = module.multi_tier_network.public_subnets\n}\n\noutput \"multi_tier_app_subnets\" {\n  description = \"Application tier subnets from the multi-tier network example\"\n  value = {\n    for key, subnet in module.multi_tier_network.private_subnets : key => subnet\n    if can(regex(\"app_subnet\", key))\n  }\n}\n\noutput \"multi_tier_db_subnets\" {\n  description = \"Database tier subnets from the multi-tier network example\"\n  value = {\n    for key, subnet in module.multi_tier_network.private_subnets : key => subnet\n    if can(regex(\"db_subnet\", key))\n  }\n}\n\n# Development network outputs\noutput \"dev_vpc_id\" {\n  description = \"VPC ID from the development network example\"\n  value       = module.dev_network.vpc_id\n}\n\n# =============================================================================\n# EXAMPLE RESOURCE DEPLOYMENT\n# =============================================================================\n# This section demonstrates how to use the module outputs to deploy\n# additional AWS resources into the created network infrastructure\n\n# Data source for the latest Ubuntu AMI\ndata \"aws_ami\" \"ubuntu\" {\n  most_recent = true\n  owners      = [\"099720109477\"] # Canonical\n  \n  filter {\n    name   = \"name\"\n    values = [\"ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*\"]\n  }\n  \n  filter {\n    name   = \"virtualization-type\"\n    values = [\"hvm\"]\n  }\n}\n\n# Example EC2 instance in the basic network's private subnet\nresource \"aws_instance\" \"example_private\" {\n  ami           = data.aws_ami.ubuntu.id\n  instance_type = \"t3.micro\"\n  \n  # Deploy into the private subnet created by the basic network module\n  subnet_id = module.basic_network.private_subnets[\"private_subnet\"].subnet_id\n  \n  tags = {\n    Name        = \"Example Private Instance\"\n    Environment = \"Example\"\n    Tier        = \"Private\"\n  }\n}\n\n# Example EC2 instance in the multi-tier network's application subnet\nresource \"aws_instance\" \"example_app_server\" {\n  ami           = data.aws_ami.ubuntu.id\n  instance_type = \"t3.micro\"\n  \n  # Deploy into one of the application tier subnets\n  subnet_id = module.multi_tier_network.private_subnets[\"app_subnet_1a\"].subnet_id\n  \n  tags = {\n    Name        = \"Example App Server\"\n    Environment = \"Production\"\n    Tier        = \"Application\"\n  }\n}\n\n# Output the instance information\noutput \"example_instances\" {\n  description = \"Information about the example EC2 instances\"\n  value = {\n    private_instance = {\n      id        = aws_instance.example_private.id\n      subnet_id = aws_instance.example_private.subnet_id\n      az        = aws_instance.example_private.availability_zone\n    }\n    app_server = {\n      id        = aws_instance.example_app_server.id\n      subnet_id = aws_instance.example_app_server.subnet_id\n      az        = aws_instance.example_app_server.availability_zone\n    }\n  }\n}